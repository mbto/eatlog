<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="jakarta.faces.core"
      xmlns:h="jakarta.faces.html"
      xmlns:cc="jakarta.faces.composite"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:o="http://omnifaces.org/ui"
      xmlns:of="http://omnifaces.org/functions">
<h:head>
    <p:importEnum type="com.github.mbto.eatlog.webapp.enums.SettingEnum" var="SettingEnum"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="robots" content="all"/>
    <meta name="description" content="#{cacheService.allocateSettingByKey(SettingEnum.DESCRIPTION_JSON.key, true, false, null).get(sessionAccount.locale.language)}"/>
    <link rel="shortcut icon" type="image/x-icon" href="#{resource['favicon.ico']}"/>
    <h:outputStylesheet name="static/css/gh-fork-ribbon.min.css" />
    <h:outputStylesheet name="static/css/default-v2.css" />
    <ui:insert name="head"/>
    <title><ui:insert name="title"/> - eatlog.ru</title>
</h:head>
<h:body>
    <a class="github-fork-ribbon right-top" href="https://github.com/mbto/eatlog" data-ribbon="Eatlog on GitHub" title="Eatlog on GitHub" target="_blank"/>
    <div class="ui-g">
    <div class="ui-g-12 ui-xl-12 ui-lg-12 ui-md-12 ui-sm-12 ui-g-nopad">
        <p:toolbar>
            <p:toolbarGroup>
                <p:linkButton href="index#{requestParamsHolder.actualRequestParamsMerged}" value="#{l10n['calculations']}" icon="pi pi-calculator"/>
                <p:linkButton href="stores#{requestParamsHolder.actualRequestParamsMerged}" value="#{l10n['stores']}" icon="pi pi-sitemap"/>
                <p:linkButton href="products#{requestParamsHolder.actualRequestParamsMerged}" value="#{l10n['products']}" icon="pi pi-cart-plus"/>
                <p:linkButton href="limitations#{requestParamsHolder.actualRequestParamsMerged}" value="#{l10n['limitations']}" icon="pi pi-exclamation-triangle"/>
                <p:linkButton href="recommendations#{requestParamsHolder.actualRequestParamsMerged}" value="#{l10n['recommendations']}" icon="pi pi-info-circle"/>
                <p:linkButton href="users#{requestParamsHolder.actualRequestParamsMerged}" value="#{l10n['users']}" icon="pi pi-users"/>
                <p:linkButton href="donate#{requestParamsHolder.actualRequestParamsMerged}" value="#{l10n['donate']}" icon="pi pi-dollar"/>
                <p:linkButton href="settings#{requestParamsHolder.actualRequestParamsMerged}" value="#{l10n['settings']}" icon="pi pi-cog"
                              rendered="#{sessionAccount.internalAccount.calcedRoles.ownerOrRedactor}"/>
            </p:toolbarGroup>
            <p:toolbarGroup align="right">
                <h:form>
                <p:selectOneMenu value="#{sessionAccount.locale}">
                    <p:ajax event="valueChange" onsuccess="document.location = document.location;"
                            listener="#{sessionAccount.onLocaleChanged()}"
                            update="@none"/>
                    <f:selectItems value="#{applicationHolder.localeSettingsByAvailableLocale.entrySet()}"
                                   var="lw"
                                   itemLabel="#{lw.value.label}" itemValue="#{lw.key}"/>
                </p:selectOneMenu>
                </h:form>
                <p:link href="account#{requestParamsHolder.actualRequestParamsMerged}"
                        style="margin-right:120px;margin-left:.1em;"
                        rendered="#{sessionAccount.authed}">
                <p:chip>
                <p:avatar shape="circle">
                    <ui:fragment rendered="#{sessionAccount.internalAccount.isBanned}">
                        <h:graphicImage value="#{resource['static/images/banned.jpg']}"/>
                    </ui:fragment>
                    <ui:fragment rendered="#{!sessionAccount.internalAccount.isBanned}">
                        <h:graphicImage value="#{sessionAccount.internalAccount.siteAvatarUrl}"
                                        rendered="#{not empty sessionAccount.internalAccount.siteAvatarUrl}"/>
                        <h:graphicImage value="#{resource['static/images/default.jpg']}"
                                        rendered="#{empty sessionAccount.internalAccount.siteAvatarUrl}"/>
                    </ui:fragment>
                </p:avatar>
                <h:outputText value="#{l10n['account']}" style="font-weight:normal;"/>
                </p:chip>
                </p:link>
                <p:linkButton href="account#{requestParamsHolder.actualRequestParamsMerged}"
                              value="#{l10n['account']}" icon="pi pi-user"
                              style="margin-right:120px;margin-left:.1em;"
                              rendered="#{!sessionAccount.authed}"/>
            </p:toolbarGroup>
        </p:toolbar>
    </div>
    <div class="ui-g-12 ui-xl-12 ui-lg-12 ui-md-12 ui-sm-12 ui-g-nopad">
        <p:messages id="userStateMsgs" for="userStateMsgs"
                    showDetail="true" skipDetailIfEqualsSummary="true"
                    style="margin:0 auto;display:table;width:500px;"/>
        <ui:fragment rendered="#{requestParamsHolder.showGoToYourPageLink}">
            <p:link value="#{l10n['go.to.your.page']}" href="#{request.requestURI}" style="margin:0 auto;display:table;"/>
        </ui:fragment>
        <ui:insert name="centerForAll"/>
        <ui:fragment rendered="#{sessionAccount.fetchAccepted}">
            <ui:insert name="centerAuthed"/>
            <ui:fragment rendered="#{sessionAccount.internalAccount.calcedRoles.ownerOrRedactor}">
                <ui:insert name="centerForOwnerOrRedactor"/>
            </ui:fragment>
        </ui:fragment>
    </div>
    </div>
    <noindex>
    <p:divider style="margin-top:10px;margin-bottom:10px;"/>
    <p:outputPanel id="siteVisitorsOutputPanelId">
        <h:outputText value="#{requestSiteVisitors.online}" styleClass="visitorPanel"/>
        <ui:repeat value="#{requestSiteVisitors.siteVisitors.authedUsers}" var="siteVisitor" varStatus="varStatus">
            <h:outputText id="visNameTextId" styleClass="visitorLink"
                          value="#{(not empty siteVisitor.geoInfo.countryEmoji ? siteVisitor.geoInfo.countryEmoji += ' ' : '') += siteVisitor.name}"/>
            <p:tooltip for="visNameTextId">
                <p:graphicImage srcset="#{siteVisitor.siteAvatarUrl}"
                                style="display:block;margin:0 auto;border-radius:50%;"
                                rendered="#{not empty siteVisitor.siteAvatarUrl}"/>
                <p:graphicImage value="#{resource['static/images/default.jpg']}"
                                style="display:block;margin:0 auto;border-radius:50%;"
                                rendered="#{empty siteVisitor.siteAvatarUrl}"/>
                <br/>
                <h:outputText value="#{siteVisitor.name}" styleClass="visitorName"/>
                <ui:fragment rendered="#{siteVisitor.geoInfo != null}">
                    <br/><h:outputText value="#{siteVisitor.geoInfo.locationByLocaleLanguage(sessionAccount.locale)}"/>
                </ui:fragment>
            </p:tooltip>
            <h:outputText value=", " rendered="#{!varStatus.last}"/>
        </ui:repeat>
    </p:outputPanel>
    <ui:fragment rendered="#{sessionAccount.fetchAccepted}">
        <ui:insert name="dialogs"/>
    </ui:fragment>
    </noindex>
    <ui:insert name="metrics">
        <h:outputText value="#{cacheService.allocateSettingByKey(SettingEnum.METRIC_SCRIPTS.key, false, false, null).value}" escape="false"/>
    </ui:insert>
    <noindex>
    <ui:insert name="excepts">
        <p:ajaxExceptionHandler onexception="PF('excWid').show();" update="expDialog" type="java.lang.Throwable"/>
        <ui:include src="../template/exceptionDialog.xhtml"/>
    </ui:insert>
    </noindex>
    <p:outputPanel style="text-align:center;" rendered="#{applicationHolder.devEnvironment and sessionAccount.authed}">
        <h:outputText value="sessionAccount.internalAccount.roles: #{sessionAccount.internalAccount.roles}"/><br/>
        <h:form>
            <p:commandButton value="Role none" actionListener="#{sessionAccount.internalAccount.setRole(null)}" process="@this" update="@all"/>
            <p:commandButton value="Role redactor" actionListener="#{sessionAccount.internalAccount.setRole('redactor')}" process="@this" update="@all"/>
            <p:commandButton value="Role admin" actionListener="#{sessionAccount.internalAccount.setRole('admin')}" process="@this" update="@all"/>
            <p:commandButton value="Role owner" actionListener="#{sessionAccount.internalAccount.setRole('owner')}" process="@this" update="@all"/>
        </h:form>
    </p:outputPanel>
</h:body>
</html>